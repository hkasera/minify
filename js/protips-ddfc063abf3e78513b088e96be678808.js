//
// showdown.js -- A javascript port of Markdown.
//
// Copyright (c) 2007 John Fraser.
//
// Original Markdown Copyright (c) 2004-2005 John Gruber
//   <http://daringfireball.net/projects/markdown/>
//
// Redistributable under a BSD-style open source license.
// See license.txt for more information.
//
// The full source distribution is at:
//
//				A A L
//				T C A
//				T K B
//
//   <http://www.attacklab.net/>
//
//
// Wherever possible, Showdown is a straight, line-by-line port
// of the Perl version of Markdown.
//
// This is not a normal parser design; it's basically just a
// series of string substitutions.  It's hard to read and
// maintain this way,  but keeping Showdown close to the original
// design makes it easier to port new features.
//
// More importantly, Showdown behaves like markdown.pl in most
// edge cases.  So web applications can do client-side preview
// in Javascript, and then build identical HTML on the server.
//
// This port needs the new RegExp functionality of ECMA 262,
// 3rd Edition (i.e. Javascript 1.5).  Most modern web browsers
// should do fine.  Even with the new regular expression features,
// We do a lot of work to emulate Perl's regex functionality.
// The tricky changes in this file mostly have the "attacklab:"
// label.  Major or self-explanatory changes don't.
//
// Smart diff tools like Araxis Merge will be able to match up
// this file with markdown.pl in a useful way.  A little tweaking
// helps: in a copy of markdown.pl, replace "#" with "//" and
// replace "$text" with "text".  Be sure to ignore whitespace
// and line endings.
//
//
// Showdown usage:
//
//   var text = "Markdown *rocks*.";
//
//   var converter = new Showdown.converter();
//   var html = converter.makeHtml(text);
//
//   alert(html);
//
// Note: move the sample code to the bottom of this
// file before uncommenting it.
//
// **************************************************
// GitHub Flavored Markdown modifications by Tekkub
// http://github.github.com/github-flavored-markdown/
//
// Modifications are tagged with "GFM"
// **************************************************
//
// Showdown namespace
//
var Showdown={};Showdown.converter=function(){var e,t,n,r=0;this.makeHtml=function(r){return e=new Array,t=new Array,n=new Array,r=r.replace(/~/g,"~T"),r=r.replace(/\$/g,"~D"),r=r.replace(/\r\n/g,"\n"),r=r.replace(/\r/g,"\n"),r="\n\n"+r+"\n\n",r=M(r),r=r.replace(/^[ \t]+$/mg,""),r=o(r),r=s(r),r=a(r),r=A(r),r=r.replace(/~D/g,"$$"),r=r.replace(/~T/g,"~"),r=r.replace(/(https?:\/\/www\.slideshare\.net\/slideshow\/embed_code\/\d+)/,"<iframe src='$1' class='slideshare'></iframe>"),r=r.replace(/https?\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!]/g,function(e,t){var n=r.slice(0,t),i=r.slice(t);return n.match(/<[^>]+$/)&&i.match(/^[^>]*>/)?e:(href=e.replace(/^http:\/\/github.com\//,"https://github.com/"),"<a href='"+href+"' target='_blank'>"+e+"</a>")}),r=r.replace(/[a-z0-9_\-+=.]+@[a-z0-9\-]+(\.[a-z0-9-]+)+/ig,function(e){return"<a href='mailto:"+e+"'>"+e+"</a>"}),r=r.replace(/[a-f0-9]{40}/ig,function(e,t){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return e;var n=r.slice(0,t),i=r.slice(t);return n.match(/@$/)||n.match(/<[^>]+$/)&&i.match(/^[^>]*>/)?e:"<a href='http://github.com/"+GitHub.nameWithOwner+"/commit/"+e+"'>"+e.substring(0,7)+"</a>"}),r=r.replace(/([a-z0-9_\-+=.]+)@([a-f0-9]{40})/ig,function(e,t,n,s){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return e;GitHub.repoName=GitHub.repoName||i();var o=r.slice(0,s),u=r.slice(s);return o.match(/\/$/)||o.match(/<[^>]+$/)&&u.match(/^[^>]*>/)?e:"<a href='http://github.com/"+t+"/"+GitHub.repoName+"/commit/"+n+"'>"+t+"@"+n.substring(0,7)+"</a>"}),r=r.replace(/([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)@([a-f0-9]{40})/ig,function(e,t,n){return"<a href='http://github.com/"+t+"/commit/"+n+"'>"+t+"@"+n.substring(0,7)+"</a>"}),r=r.replace(/[ (\[#]+([0-9]+)/ig,function(e,t,n){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return e;var i=r.slice(0,n),s=r.slice(n);return i==""||i.match(/[a-z0-9_\-+=.]$/)||i.match(/<[^>]+$/)&&s.match(/^[^>]*>/)?e:"<a href='http://github.com/"+GitHub.nameWithOwner+"/issues/#issue/"+t+"'>"+e+"</a>"}),r=r.replace(/[ (\[#]+([a-z0-9_\-+=.]+)#([0-9]+)/ig,function(e,t,n,s){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return e;GitHub.repoName=GitHub.repoName||i();var o=r.slice(0,s),u=r.slice(s);return o.match(/\/$/)||o.match(/<[^>]+$/)&&u.match(/^[^>]*>/)?e:"<a href='http://github.com/"+t+"/"+GitHub.repoName+"/issues/#issue/"+n+"'>"+e+"</a>"}),r=r.replace(/[ (\[#]+([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)#([0-9]+)/ig,function(e,t,n){return"<a href='http://github.com/"+t+"/issues/#issue/"+n+"'>"+e+"</a>"}),r};var i=function(){return GitHub.nameWithOwner.match(/^.+\/(.+)$/)[1]},s=function(n){var n=n.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(n,r,i,s,o){return r=r.toLowerCase(),e[r]=N(i),s?s+o:(o&&(t[r]=o.replace(/"/g,"&quot;")),"")});return n},o=function(e){e=e.replace(/\n/g,"\n\n");var t="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",n="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,u),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,u),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,u),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,u),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,u),e=e.replace(/\n\n/g,"\n"),e},u=function(e,t){var r=t;return r=r.replace(/\n\n/g,"\n"),r=r.replace(/^\n/,""),r=r.replace(/\n+$/g,""),r="\n\n~K"+(n.push(r)-1)+"K\n\n",r},a=function(e){e=v(e);var t=b("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,t),e=g(e),e=y(e),e=x(e),e=o(e),e=T(e),e},f=function(e){return e=w(e),e=l(e),e=C(e),e=p(e),e=c(e),e=k(e),e=N(e),e=S(e),e=e.replace(/  +\n/g," <br />\n"),e},l=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=_(t,"\\`*_"),t}),e},c=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,h),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,h),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,h),e},h=function(n,r,i,s,o,u,a,f){f==undefined&&(f="");var l=r,c=i,h=s.toLowerCase(),p=o,d=f;if(p==""){h==""&&(h=c.toLowerCase().replace(/ ?\n/g," ")),p="#"+h;if(e[h]!=undefined)p=e[h],t[h]!=undefined&&(d=t[h]);else{if(!(l.search(/\(\s*\)$/m)>-1))return l;p=""}}p=_(p,"*_");var v='<a href="'+p+'"';return d!=""&&(d=d.replace(/"/g,"&quot;"),d=_(d,"*_"),v+=' title="'+d+'"'),v+=">"+c+"</a>",v},p=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,d),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,d),e},d=function(n,r,i,s,o,u,a,f){var l=r,c=i,h=s.toLowerCase(),p=o,d=f;d||(d="");if(p==""){h==""&&(h=c.toLowerCase().replace(/ ?\n/g," ")),p="#"+h;if(e[h]==undefined)return l;p=e[h],t[h]!=undefined&&(d=t[h])}c=c.replace(/"/g,"&quot;"),p=_(p,"*_");var v='<img src="'+p+'" alt="'+c+'"';return d=d.replace(/"/g,"&quot;"),d=_(d,"*_"),v+=' title="'+d+'"',v+=" />",v},v=function(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return b("<h1>"+f(t)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return b("<h2>"+f(t)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var r=t.length;return b("<h"+r+">"+f(n)+"</h"+r+">")}),e},m,g=function(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return r?e=e.replace(t,function(e,t,n){var r=t,i=n.search(/[*+-]/g)>-1?"ul":"ol";r=r.replace(/\n{2,}/g,"\n\n\n");var s=m(r);return s=s.replace(/\s+$/,""),s="<"+i+">"+s+"</"+i+">\n",s}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,r){var i=t,s=n,o=r.search(/[*+-]/g)>-1?"ul":"ol",s=s.replace(/\n{2,}/g,"\n\n\n"),u=m(s);return u=i+"<"+o+">\n"+u+"</"+o+">\n",u})),e=e.replace(/~0/,""),e};m=function(e){return r++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(e,t,n,r,i){var s=i,o=t,u=n;return o||s.search(/\n{2,}/)>-1?s=a(O(s)):(s=g(O(s)),s=s.replace(/\n$/,""),s=f(s)),"<li>"+s+"</li>\n"}),e=e.replace(/~0/g,""),r--,e};var y=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var r=t,i=n;return r=E(O(r)),r=M(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>",b(r)+i}),e=e.replace(/~0/,""),e},b=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(e)-1)+"K\n\n"},w=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,r,i){var s=r;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=E(s),t+"<code>"+s+"</code>"}),e},E=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=_(e,"*_{}[]\\",!1),e},S=function(e){return e=e.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\w)_(\w)/g,"$1~E95E$2"),e=e.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>"),e},x=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=a(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /mg,"~0"),n=n.replace(/~0/g,""),n}),b("<blockquote>\n"+n+"\n</blockquote>")}),e},T=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");var t=e.split(/\n{2,}/g),r=new Array,i=t.length;for(var s=0;s<i;s++){var o=t[s];o.search(/~K(\d+)K/g)>=0?r.push(o):o.search(/\S/)>=0&&(o=f(o),o=o.replace(/\n/g,"<br />"),o=o.replace(/^([ \t]*)/g,"<p>"),o+="</p>",r.push(o))}i=r.length;for(var s=0;s<i;s++)while(r[s].search(/~K(\d+)K/)>=0){var u=n[RegExp.$1];u=u.replace(/\$/g,"$$$$"),r[s]=r[s].replace(/~K\d+K/,u)}return r.join("\n\n")},N=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),e},C=function(e){return e=e.replace(/\\(\\)/g,D),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,D),e},k=function(e){return e=e.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return L(A(t))}),e},L=function(e){function t(e){var t="0123456789ABCDEF",n=e.charCodeAt(0);return t.charAt(n>>4)+t.charAt(n&15)}var n=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+t(e)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if(e=="@")e=n[Math.floor(Math.random()*2)](e);else if(e!=":"){var t=Math.random();e=t>.9?n[2](e):t>.45?n[1](e):n[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">'),e},A=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)}),e},O=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,""),e},M=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t,n){var r=t,i=4-r.length%4;for(var s=0;s<i;s++)r+=" ";return r}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,""),e},_=function(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var i=new RegExp(r,"g");return e=e.replace(i,D),e},D=function(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}};var CanvasImage=function(e,t){this.image=t,this.element=e,this.element.width=this.image.width,this.element.height=this.image.height;var n=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,r=navigator.appVersion.indexOf("Mac")>-1;n&&r&&(this.element.width=Math.min(this.element.width,300),this.element.height=Math.min(this.element.height,200)),this.context=this.element.getContext("2d"),this.context.drawImage(this.image,0,0)};CanvasImage.prototype={blur:function(e){this.context.globalAlpha=.5;for(var t=-e;t<=e;t+=2)for(var n=-e;n<=e;n+=2)this.context.drawImage(this.element,n,t),n>=0&&t>=0&&this.context.drawImage(this.element,-(n-1),-(t-1));this.context.globalAlpha=1}},$(function(){var e,t,n;$(".blur").each(function(){n=this,e=new Image,e.onload=function(){t=new CanvasImage(n,this),t.blur(4)},e.src=$(this).attr("src")})}),function(e){function u(){}jQuery.event.props.push("dataTransfer");var t={fallback_id:"",url:"",refresh:1e3,paramname:"userfile",allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:u,dragStart:u,dragEnter:u,dragOver:u,dragLeave:u,docEnter:u,docOver:u,docLeave:u,beforeEach:u,afterAll:u,rename:u,error:function(e,t,n,r){alert(e)},uploadStarted:u,uploadFinished:u,progressUpdated:u,globalProgressUpdated:u,speedUpdated:u},n=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError"],r,i=!1,s=0,o;e.fn.filedrop=function(u){function l(e){return a.drop.call(this,e)===!1?!1:(o=e.dataTransfer.files,o===null||o===undefined||o.length===0?(a.error(n[0]),!1):(s=o.length,d(),e.preventDefault(),!1))}function c(t,n,r,i){var s="--",o="\r\n",u="";if(a.data){var f=e.param(a.data).replace(/\+/g,"%20").split(/&/);e.each(f,function(){var e=this.split("=",2),t=decodeURIComponent(e[0]),n=decodeURIComponent(e[1]);u+=s,u+=i,u+=o,u+='Content-Disposition: form-data; name="'+t+'"',u+=o,u+=o,u+=n,u+=o})}return u+=s,u+=i,u+=o,u+='Content-Disposition: form-data; name="'+a.paramname+'"',u+='; filename="'+t+'"',u+=o,u+="Content-Type: "+r,u+=o,u+=o,u+=n,u+=o,u+=s,u+=i,u+=s,u+=o,u}function h(e){if(e.lengthComputable){var t=Math.round(e.loaded*100/e.total);if(this.currentProgress!==t){this.currentProgress=t,a.progressUpdated(this.index,this.file,this.currentProgress),f[this.global_progress_index]=this.currentProgress,p();var n=(new Date).getTime(),r=n-this.currentStart;if(r>=a.refresh){var i=e.loaded-this.startData,s=i/r;a.speedUpdated(this.index,this.file,s),this.startData=e.loaded,this.currentStart=n}}}}function p(){if(f.length===0)return;var e=0,t;for(t in f)f.hasOwnProperty(t)&&(e+=f[t]);a.globalProgressUpdated(Math.round(e/f.length))}function d(){i=!1;if(!o)return a.error(n[0]),!1;if(a.allowedfiletypes.push&&a.allowedfiletypes.length)for(var t=o.length;t--;)if(!o[t].type||e.inArray(o[t].type,a.allowedfiletypes)<0)return a.error(n[3],o[t]),!1;var r=0,u=0;if(s>a.maxfiles&&a.queuefiles===0)return a.error(n[1]),!1;var l=[],d=[],b=[];for(var w=0;w<s;w++)l.push(w);var E=function(e){setTimeout(S,e);return},S=function(){var e;if(i)return!1;if(a.queuefiles>0&&d.length>=a.queuefiles)return E(a.queuewait);e=l[0],l.splice(0,1),d.push(e);try{if(g(o[e])!==!1){if(e===s)return;var t=new FileReader,r=1048576*a.maxfilesize;t.index=e;if(o[e].size>r)return a.error(n[2],o[e],e),d.forEach(function(t,n){t===e&&d.splice(n,1)}),u++,!0;t.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return a.error(n[4]),!1;case e.target.error.NOT_READABLE_ERR:return a.error(n[5]),!1;case e.target.error.ABORT_ERR:return a.error(n[6]),!1;default:return a.error(n[7]),!1}},t.onloadend=a.beforeSend?function(t){a.beforeSend(o[e],e,function(){x(t)})}:x,t.readAsBinaryString(o[e])}else u++}catch(f){return d.forEach(function(t,n){t===e&&d.splice(n,1)}),a.error(n[0]),!1}l.length>0&&S()},x=function(t){var n=(typeof t.srcElement=="undefined"?t.target:t.srcElement).index;t.target.index===undefined&&(t.target.index=v(t.total));var l=new XMLHttpRequest,g=l.upload,w=o[t.target.index],E=t.target.index,S=(new Date).getTime(),x="------multipartformboundary"+(new Date).getTime(),T=f.length,N,C=m(w.name),k=w.type;a.withCredentials&&(l.withCredentials=a.withCredentials),typeof C=="string"?N=c(C,t.target.result,k,x):N=c(w.name,t.target.result,k,x),g.index=E,g.file=w,g.downloadStartTime=S,g.currentStart=S,g.currentProgress=0,g.global_progress_index=T,g.startData=0,g.addEventListener("progress",h,!1),jQuery.isFunction(a.url)?l.open("POST",a.url(),!0):l.open("POST",a.url,!0),l.setRequestHeader("content-type","multipart/form-data; boundary="+x),e.each(a.headers,function(e,t){l.setRequestHeader(e,t)}),l.sendAsBinary(N),f[T]=0,p(),a.uploadStarted(E,w,s),l.onload=function(){var e=null;if(l.responseText)try{e=jQuery.parseJSON(l.responseText)}catch(t){e=l.responseText}var o=(new Date).getTime(),c=o-S,h=a.uploadFinished(E,w,e,c,l);r++,d.forEach(function(e,t){e===n&&d.splice(t,1)}),b.push(n),f[T]=100,p(),r===s-u&&y(),h===!1&&(i=!0),(l.status<200||l.status>299)&&a.error(l.statusText,w,n,l.status)}};S()}function v(e){for(var t=0;t<s;t++)if(o[t].size===e)return t;return undefined}function m(e){return a.rename(e)}function g(e){return a.beforeEach(e)}function y(){return a.afterAll()}function b(e){clearTimeout(r),e.preventDefault(),a.dragEnter.call(this,e)}function w(e){clearTimeout(r),e.preventDefault(),a.docOver.call(this,e),a.dragOver.call(this,e)}function E(e){clearTimeout(r),a.dragLeave.call(this,e),e.stopPropagation()}function S(e){return e.preventDefault(),a.docLeave.call(this,e),!1}function x(e){return clearTimeout(r),e.preventDefault(),a.docEnter.call(this,e),!1}function T(e){return clearTimeout(r),e.preventDefault(),a.docOver.call(this,e),!1}function N(e){r=setTimeout(function(t){return function(){a.docLeave.call(t,e)}}(this),200)}var a=e.extend({},t,u),f=[];return this.on("drop",l).on("dragstart",a.dragStart).on("dragenter",b).on("dragover",w).on("dragleave",E),e(document).on("drop",S).on("dragenter",x).on("dragover",T).on("dragleave",N),e("#"+a.fallback_id).change(function(e){a.drop(e),o=e.target.files,s=o.length,d()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return e.charCodeAt(0)&255}var n=Array.prototype.map.call(e,t),r=new Uint8Array(n);this.send(r.buffer)}}catch(a){}}(jQuery),function(){var e=function(){var e=typeof document.selection!="undefined"&&typeof document.selection.createRange!="undefined";return{getSelectionRange:function(t){var n,r,i,s,o,u;t.focus();if(typeof t.selectionStart!="undefined")n=t.selectionStart,r=t.selectionEnd;else{if(!e)throw"Unable to get selection range.";i=document.selection.createRange(),s=i.text.length;if(i.parentElement()!==t)throw"Unable to get selection range.";t.type==="textarea"?(o=i.duplicate(),o.moveToElementText(t),o.setEndPoint("EndToEnd",i),n=o.text.length-s):(u=t.createTextRange(),u.setEndPoint("EndToStart",i),n=u.text.length),r=n+s}return{start:n,end:r}},getSelectionStart:function(e){return this.getSelectionRange(e).start},getSelectionEnd:function(e){return this.getSelectionRange(e).end},setSelectionRange:function(t,n,r){var i,s;t.focus(),typeof r=="undefined"&&(r=n);if(typeof t.selectionStart!="undefined")t.setSelectionRange(n,r);else{if(!e)throw"Unable to set selection range.";i=t.value,s=t.createTextRange(),r-=n+i.slice(n+1,r).split("\n").length-1,n-=i.slice(0,n).split("\n").length-1,s.move("character",n),s.moveEnd("character",r),s.select()}},getSelectedText:function(e){var t=this.getSelectionRange(e);return e.value.substring(t.start,t.end)},insertText:function(e,t,n,r,i){r=r||n;var s=t.length,o=n+s,u=e.value.substring(0,n),a=e.value.substr(r);e.value=u+t+a,i===!0?this.setSelectionRange(e,n,o):this.setSelectionRange(e,o)},replaceSelectedText:function(e,t,n){var r=this.getSelectionRange(e);this.insertText(e,t,r.start,r.end,n)},wrapSelectedText:function(e,t,n,r){var i=t+this.getSelectedText(e)+n;this.replaceSelectedText(e,i,r)}}}();window.Selection=e}(),function(e){e.fn.extend({getSelectionRange:function(){return Selection.getSelectionRange(this[0])},getSelectionStart:function(){return Selection.getSelectionStart(this[0])},getSelectionEnd:function(){return Selection.getSelectionEnd(this[0])},getSelectedText:function(){return Selection.getSelectedText(this[0])},setSelectionRange:function(e,t){return this.each(function(){Selection.setSelectionRange(this,e,t)})},insertText:function(e,t,n,r){return this.each(function(){Selection.insertText(this,e,t,n,r)})},replaceSelectedText:function(e,t){return this.each(function(){Selection.replaceSelectedText(this,e,t)})},wrapSelectedText:function(e,t,n){return this.each(function(){Selection.wrapSelectedText(this,e,t,n)})}})}(jQuery),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P;window.handle_redirect=function(e){if(e.status==="redirect")return window.location=e.to},$(window).load(function(){if($("#q").length>0)return S()}),$(function(){return $(window).scroll(function(){if($(window).scrollTop()>0)return $(".side-conversion-alert").fadeIn()}),initializeProtip(),$("#x-protip-preview"),$.ajaxPrefilter(function(e,t,n){var r;return r=e.success,e.success=function(e){handle_redirect(e);if(r!=null)return r(e)}}),$(".submit-on-enter").keydown(function(e){if(e.keyCode===13)return C(null)})}),window.initializeProtip=function(){var t;return(t=$(".x-tip-content.preview").length>0)?(setTimeout(function(){return e()},100),x(),E(),f(),$("#protip_title").focus()):typeof hljs!="undefined"&&hljs!==null&&highlightCode(),$("input[name=authenticity_token]").val($("meta[name=csrf-token]").attr("content")),$("a.protip-subscription:not(.noauth)").on("click",function(e){var t,n;return n=$(this),t=n.attr("href"),O(n),$.ajax(t,{type:"PUT",dataType:"text",error:function(e,t,r){return O(n)},success:function(e){return handle_redirect(e)}}),e.preventDefault()}),registerToggles(),l(),registerMoreHistory(),a(),u(),o(),c(),d(),p(),k()},O=function(e){var t;return e.toggleClass("subscribed"),t=e.data("reverse-action"),e.data("reverse-action",e.attr("href")),e.attr("href",t)},n=$(".card .side"),P=0,y=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,$.fn.vertical_float_to=function(e){if(e)return this.animate({top:$(e).height()+$(e).offset().top+25})},e=function(e){var t;return t=n[P],$(t).outerHeight()+$(t).offset().top>$(".vertical-floatable").offset().top&&$(".vertical-floatable").hide(),setTimeout(function(){return D()},e)},D=function(){return $(".vertical-floatable").vertical_float_to(n[P]),setTimeout(function(){return $(".vertical-floatable").show()},400)},E=function(){return y&&$(".back.side").addClass("faded"),$(document).keydown(function(e){if((e.keyCode===38||e.keyCode===40)&&(e.ctrlKey||e.metaKey))return m()}),$(".preview-button").bind("click",function(e){return e.preventDefault(),m()})},m=function(){return $(".card").hasClass("rotated")?v():h()},w=function(e){return $("#x-protip-preview").html(e),v()},v=function(){var t;return y&&$(n[P]).toggleClass("faded"),P=(P+1)%n.length,y&&$(n[P]).toggleClass("faded"),t=$(".card"),t.toggleClass("rotated"),$(".tip-panel").height($(".tip-panel").parent().outerHeight()),e(500)},h=function(){var e,t,n;return t=$("#protip_title").val(),e=$("#protip_body").val(),n=$("#protip_tags").val(),$.ajax("/p/preview",{type:"POST",data:{protip:{title:t,body:e,topics:n}},success:function(e,t,n){return w(e)}})},x=function(){return $("textarea").keydown(function(e){if(e.keycode===13)return N()}),$("textarea").bind("paste, input, focus",function(){return N()})},N=function(){return $("textarea").each(function(t,n){var r,i,s;i=n.scrollHeight,r=n.clientHeight,s=3;if(i>r)return n.style.height=i+5*s+"px",e(50)}),setTimeout(N,1e3)},f=function(){var e,t,n;return n=(window.File&&window.FileReader&&window.FileList&&window.Blob)!==void 0,t=$("#dropzone input[type=file].safari5-upload-hack"),e=$("#dropzone"),e.filedrop({maxfiles:5,maxfilesize:2,paramname:"picture",headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content"),Accept:"text/javascript"},url:$("#dropzone").attr("data-picture-upload-path"),shouldupload:n,input_element:n?null:t,dragOver:function(){return s()},dragLeave:function(){return i()},uploadStarted:function(e,t,n){return _(e,t,n)},uploadFinished:function(e,t,n,r){return M(e,t,n,r)}})},s=function(){return $("#dropzone").addClass("upload-ready")},i=function(){return $("#dropzone").removeClass("upload-ready")},_=function(e,t,n){return $("#dropzone").removeClass("upload-ready"),$("#dropzone").addClass("upload-in-progress")},M=function(e,t,n,r){var i;return i="![Picture]("+n.file.url+")",$("#protip_body").val($("#protip_body").val()+i),$("#dropzone").removeClass("upload-in-progress")},window.registerToggles=function(){return $(".upvote,.small-upvote").on("click",function(){return $(this).not(".upvoted").length===1&&$(this).html(Number($(this).html())+1),$(this).addClass("upvoted")}),$(".flag").on("click",function(){return $(this).toggleClass("flagged")}),$(".queue").on("click",function(){return $(this).toggleClass("queued")}),$(".feature").on("click",function(){return $(this).toggleClass("featured")}),$(".like").on("click",function(){return $(this).addClass("liked"),$(this).removeClass("not-liked")}),$(".follow-user").on("click",function(){return $(this).addClass("following-user"),$(this).removeClass("follow-user")})},l=function(){return $(".slidedown").on("click",function(e){var t;return t=$("#"+$(this).data("target")),t.animate({opacity:"toggle"}),t.find("input[type=text]").first().focus(),e.preventDefault()}),$(".slideup").on("click",function(e){return $("#"+$(this).data("target")).animate({opacity:"toggle"}),r(),e.preventDefault()})},T=!1,S=function(){return $(window).bind("popstate",function(){var e;e=History.getState();if(!$.isEmptyObject(e.data)&&!T)return C(e.data),$(".slidedown").trigger("click")})},window.recordSearchUrlInHistory=function(e){e==null&&(e=null),e==null&&(e={q:$("#q").val()});if(!$.isEmptyObject(e.q))return T=!0,History.replaceState(e,"Search results")},r=function(){return History.replaceState(null,window.location.title)},C=function(e){var n,r,i;n=$("#q").closest("form");for(r in e)i=e[r],r==="q"?$("#q").val(i):t(r,i,n);return $("#q").trigger("submit"),recordSearchUrlInHistory()},t=function(e,t,n){return $("<input>").attr("type","hidden").attr("name",e).val(t).appendTo(n)},c=function(){return $("#protip_body,#comment_comment").keydown(function(e){var t;if(e.keyCode===9){t=$(this).getSelectedText();if(!$.isEmptyObject(t))return $(this).replaceSelectedText(L(t,4),!1),e.preventDefault()}})},L=function(e,t){var n,r,i;r="";for(n=i=1;1<=t?i<=t:i>=t;n=1<=t?++i:--i)r+=" ";return r+e.split("\n").join("\n"+r)},d=function(){return $("code").each(function(){if($(this).outerHeight()<300)return $(this).css("overflow-y","hidden")})},p=function(){var e,t;t=g("comment"),e=$(".add-comment #comment_comment");if(e.length!==0&&e.val().length===0&&t!=null)return e.val(t)},k=function(){return $("#x-mobile-menu").slideToggle(),$("#x-mobile-toggle").on("click",function(){return $("#x-mobile-menu").slideToggle()})},g=function(e){var t,n;return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search),n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))},b=!1,window.registerMoreHistory=function(){},window.highlightCode=function(){return hljs.initHighlighting()},a=function(){return $(".reply").on("click",function(){var e,t;return t=$(this).closest("li.cf").find("a.comment-user").attr("data-reply-to"),e=$("#add-comment textarea"),e.text("@"+t+" "),e.setSelectionRange(e.val().length)})},u=function(){return $(".like").one("click",function(){var e;return e=Number($(this).text()),e+=1,$(this).text(e)})},o=function(){return $("a.edit, .edit-comment .button").on("click",function(){var e;return e=$(this).closest("li.cf").find(".comment"),A(e)})},A=function(e){return e.children("p").first().toggleClass("hidden"),e.find(".edit-comment").toggleClass("hidden"),e.siblings("ul.edit-del").toggleClass("hidden")}}.call(this);